# バーコードバトラー機能計画

## 概要

90年代の「バーコードバトラー」をオマージュ。
投稿からバーコードを生成し、バトルできる機能。

## コンセプト

- 各投稿に一意のバーコードが表示される
- バーコードはeventIDから生成（投稿内容は使わない＝編集しても変わらない）
- バーコード同士をバトルさせられる
- じゃんけん的な3すくみの戦闘システム

## バーコード表示

### 投稿カードでの表示

```
┌─ 投稿 ──────────────────────────────┬═╗
│ @username · 2時間前                 │║│
│                                     │║│ ← バーコード（縦向き）
│ 今日のランチ美味しかった！           │║│
│                                     │R │ ← レアリティ
└─────────────────────────────────────┴─┘
```

- 位置: 投稿カード右辺に接地（縦向き・90度回転）
- 通常時: opacity 0.3（控えめ）
- ホバー時: opacity 0.7 + 背景色（バーコードリーダーで読める状態）

### 表示箇所

| 箇所 | 表示 | 理由 |
|------|------|------|
| タイムラインの投稿カード | ✅ | メイン表示 |
| 投稿個別ページの主記事 | ✅ | メイン表示 |
| 元記事カード（Reply to） | ❌ | 高さが足りない |
| リプライカード | ❌ | 高さが足りない |
| インデントされたリプライ | ❌ | 高さが足りない |

### テーマ対応

| テーマ | バーコード色 | ホバー時背景 |
|--------|-------------|-------------|
| ライト | 黒 | 白 |
| ダーク | 白 | 黒 |

## ステータス生成

### 3つのステータス

| ステータス | 略称 | 相性 |
|-----------|------|------|
| ATTACK (攻撃) | ATK | DEFに強い |
| DEFENSE (防御) | DEF | SPDに強い |
| SPEED (速度) | SPD | ATKに強い |

```
    ATK
   ↗   ↘
SPD  ←  DEF

ATK > DEF > SPD > ATK（3すくみ）
```

### 生成ロジック

- eventIDのSHA-256ハッシュを3分割してステータス（0-99）を生成
- 同じ投稿 = 同じバーコード = 同じステータス
- 編集してもeventIdは変わらないため、バーコードも変わらない

## バーコード規格

- **Code 128** を使用（JsBarcodeライブラリ）
- 実際のバーコードリーダーで読み取り可能
- エンコード形式: `AADDSS`（ATK 2桁 + DEF 2桁 + SPD 2桁）

## バトルシステム（未実装）

### 勝敗判定

3すくみの相性で勝敗を決定:
- ATK vs DEF → ATKが高い方が勝ち
- DEF vs SPD → DEFが高い方が勝ち
- SPD vs ATK → SPDが高い方が勝ち

3つの対戦で勝ち数が多い方が勝利。

### バトルの始め方

1. **投稿を選んでバトル**: 自分の投稿の「バトル」ボタン → 対戦相手選択
2. **ランダムマッチ**: タイムラインからランダムに2投稿を選出
3. **バトル招待**: バーコードをシェアして対戦

## レアリティ（実装済み）

合計値（ATK+DEF+SPD）でレアリティ判定:

| 合計 | レアリティ | 表示 | 出現率 |
|------|-----------|------|--------|
| 0-149 | Normal | N | 50.75% |
| 150-199 | Rare | R | 33.08% |
| 200-249 | Super Rare | SR | 14.21% |
| 250-297 | Ultra Rare | UR | 1.96% |

## 実装ファイル

- `apps/web/src/lib/barcode/barcode.ts` - ステータス生成ロジック
- `apps/web/src/components/post/PostBarcode.tsx` - 表示コンポーネント
- `apps/web/src/styles/components/post-card.css` - スタイル

## 実装優先度

1. ✅ ステータス生成アルゴリズム
2. ✅ バーコード表示（Code 128規格）
3. ✅ レアリティ表示（N/R/SR/UR）
4. ✅ ホバー時の背景表示
5. ✅ ダークテーマ対応
6. バトル機能（1対1）
7. バトル結果シェア
8. ランダムマッチ
9. トーナメント機能

## 注意点

- バーコードは装飾であり、邪魔にならないように
- ホバーで詳細表示（常時は控えめ）
- バトルは強制ではない（楽しみたい人だけ）
- 投稿の質 ≠ バーコードの強さ（あくまでお遊び）
