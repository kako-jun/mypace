# プロフィール追加機能計画

## 1. ピン留め投稿 ✅ 実装済み

### 概要

プロフィールページの先頭に固定表示する投稿。
Twitterの「固定ツイート」と同じ概念。

**実装詳細:**
- D1テーブル `user_pins` で管理
- API: `GET/POST/DELETE /api/pins/:pubkey`
- プロフィールページで自分の投稿にPIN/UNPINボタン表示
- ピン留め投稿はタイムラインの先頭に「Pinned」ラベル（Pinアイコン付き）で表示

### 表示

```
┌─ プロフィール ────────────────────────────┐
│                                          │
│ [アバター] @username                     │
│           mypace #42 🥈                  │
│           自己紹介テキスト...             │
│                                          │
│ ─────────────────────────────────────    │
│                                          │
│ 📌 ピン留め投稿                           │
│ ┌────────────────────────────────────┐  │
│ │ これが私の代表作です！              │  │
│ │ ★★★★★ ● ◆                       │  │
│ └────────────────────────────────────┘  │
│                                          │
│ ─────────────────────────────────────    │
│                                          │
│ 📝 投稿一覧                              │
│ ┌────────────────────────────────────┐  │
│ │ 最新の投稿...                       │  │
│ └────────────────────────────────────┘  │
│                                          │
└──────────────────────────────────────────┘
```

### ピン留め操作

```
投稿カードのメニュー:
┌──────────────────┐
│ ✏️ 編集           │
│ 📌 ピン留め       │  ← 新規追加
│ 🗑️ 削除           │
└──────────────────┘
```

### データ構造

**方法1: プロフィールに保存**
```json
{
  "kind": 0,
  "content": "{...profile...}",
  "tags": [
    ["mypace", "pinned", "<event_id>"]
  ]
}
```

**方法2: API/D1で管理**
```sql
CREATE TABLE user_pins (
  pubkey TEXT PRIMARY KEY,
  pinned_event_id TEXT,
  pinned_at INTEGER
);
```

### 制限

- ピン留めは1投稿のみ
- 自分の投稿のみピン可能
- 削除された投稿は自動解除

---

## 2. 再投稿（リトライ）機能

### 背景の問題

- 良い投稿をしてもバズらないことがある
- 純正リポストだと元投稿のステラが消える
- 同じ内容を新規投稿するのは「ずるい」感じがする
- でも本当はもう一度チャンスが欲しい

### mypaceのアプローチ

**「リトライ」を公式機能にして文化を作る**

- 同じ内容の再投稿を「リトライ」と呼ぶ
- 恥ずかしいことではない、普通のこと
- 元投稿へのリンク付きで透明性確保
- ステラは新規投稿に付く（元投稿は残る）

### UIの流れ

```
投稿カードのメニュー:
┌──────────────────┐
│ ✏️ 編集           │
│ 📌 ピン留め       │
│ 🔄 リトライ       │  ← 新規追加
│ 🗑️ 削除           │
└──────────────────┘
```

### リトライ投稿の表示

```
┌─ リトライ投稿 ─────────────────────────────┐
│                                            │
│ 🔄 リトライ投稿 (元投稿: 2025/01/01)        │
│                                            │
│ @username · たった今                       │
│                                            │
│ これは私の渾身の投稿です！                   │
│ もう一度読んでほしい！                      │
│                                            │
│ ★☆☆☆☆                    [元投稿を見る]  │
│                                            │
└────────────────────────────────────────────┘
```

### データ構造

```json
{
  "kind": 1,
  "content": "これは私の渾身の投稿です！\nもう一度読んでほしい！",
  "tags": [
    ["t", "mypace"],
    ["mypace", "retry", "<original_event_id>"]
  ]
}
```

### 元投稿との関係

```
元投稿 (2025/01/01)
  ★★★ (3個のステラ)
  └─ そのまま残る

リトライ投稿 (2025/03/15)
  ★☆☆ (新たにステラを集める)
  └─ 「元投稿を見る」リンク
```

### リトライの哲学

```
従来のSNS:
  同じ内容の投稿 = スパム、ずるい、恥ずかしい

mypace:
  リトライ = 公式機能
  「もう一度チャンスをください」= 普通のこと
  透明性がある（元投稿リンク）
  元投稿のステラは消えない
```

### リトライ回数の表示（オプション）

```
┌─ 投稿 ────────────────────────────┐
│ @username · 2時間前               │
│                                   │
│ 渾身の投稿です！                   │
│                                   │
│ ★★★★★        🔄 3回目のリトライ  │
└───────────────────────────────────┘
```

- 何回リトライしたかを表示
- 「この人は本当にこれを伝えたいんだな」感
- 恥ずかしさではなく、熱意の証明

### リトライ制限（オプション）

| 設定 | 説明 |
|------|------|
| 制限なし | 何回でもリトライ可 |
| 1日1回 | 同じ投稿は1日1リトライまで |
| 週1回 | 週に1回まで |

→ 最初は制限なしで様子見

---

## 実装優先度

### ピン留め
1. ピン留めUI（メニュー追加）
2. プロフィールでの表示
3. データ保存（D1 or プロフィールタグ）

### リトライ
1. リトライUI（メニュー追加）
2. タグ付き新規投稿
3. リトライ表示（ラベル、元投稿リンク）
4. リトライ回数表示

---

## 期待される文化

### ピン留め
- 「これが私の代表作」を見せられる
- プロフィール訪問者への自己紹介的投稿

### リトライ
- バズらなくても気軽に再挑戦
- 「ステラ0でも恥ずかしくない」文化
- 埋もれた良コンテンツの再発掘
- 作者の熱意が伝わる
