# åº§æ¨™æŠ•ç¨¿æ©Ÿèƒ½è¨ˆç”»

## æ¦‚è¦

æŠ•ç¨¿ã«å ´æ‰€æƒ…å ±ã‚’æ·»ä»˜ã§ãã‚‹æ©Ÿèƒ½ã€‚
å†™çœŸã®EXIFã‚„ç¾åœ¨åœ°ã¨ã¯ç„¡é–¢ä¿‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å ´æ‰€ã‚’æŒ‡å®šã—ã¦æŠ•ç¨¿ã€‚

## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

```
@@é‡‘é–£å¯º

ç´…è‘‰ã®æ™‚æœŸãŒæœ€é«˜ã ã£ãŸ

ğŸ“ é‡‘é–£å¯º [åœ°å›³]
```

ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µã‚¤ãƒˆçš„ãªä½¿ã„æ–¹ã€‚ã€Œã“ã“ã«è¡Œã£ãŸæ„Ÿæƒ³ã€ã‚’æ›¸ãã¨ãã«ä½¿ã†ã€‚

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### Nostrã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚°ï¼ˆNIP-52æº–æ‹ ï¼‰

```json
{
  "kind": 1,
  "content": "é‡‘é–£å¯ºã«è¡Œã£ã¦ããŸï¼\nhttps://example.com/photo.jpg",
  "tags": [
    ["t", "mypace"],
    ["g", "xn76urx1"],
    ["location", "é‡‘é–£å¯º"]
  ]
}
```

| ã‚¿ã‚° | å¿…é ˆ | èª¬æ˜ |
|------|------|------|
| `g` | â—‹ | geohashï¼ˆ8æ–‡å­—æ¨å¥¨ï¼‰ |
| `location` | â–³ | åœ°åï¼ˆè¡¨ç¤ºç”¨ã€ä»»æ„ï¼‰ |

### Geohashç²¾åº¦

| æ–‡å­—æ•° | ç²¾åº¦ | ç”¨é€” |
|--------|------|------|
| 6 | Â±610m | ç”ºãƒ»ã‚¨ãƒªã‚¢ |
| 7 | Â±76m | é€šã‚Š |
| 8 | Â±19m | å»ºç‰©ï¼ˆæ¨å¥¨ï¼‰ |
| 9 | Â±2m | æ­£ç¢ºãªä½ç½® |

## æŠ•ç¨¿UI

```
â”Œâ”€ å ´æ‰€ã‚’è¿½åŠ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” [é‡‘é–£å¯º          ] [æ¤œç´¢]     â”‚
â”‚                                  â”‚
â”‚ â”œ é‡‘é–£å¯ºï¼ˆäº¬éƒ½å¸‚åŒ—åŒºï¼‰           â”‚
â”‚ â”œ é‡‘é–£å¯ºå‰ãƒã‚¹åœ                 â”‚
â”‚ â”” é‡‘é–£å¯ºé“                       â”‚
â”‚                                  â”‚
â”‚ [åœ°å›³] [èˆªç©ºå†™çœŸ]                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚    Leaflet + OSM/ESRI       â”‚  â”‚
â”‚ â”‚         ğŸ“ â† ãƒ‰ãƒ©ãƒƒã‚°ã§å¾®èª¿æ•´ â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚
â”‚ ç²¾åº¦: [å»ºç‰© â–¼] (8æ–‡å­—/Â±19m)     â”‚
â”‚                                  â”‚
â”‚ [ã‚­ãƒ£ãƒ³ã‚»ãƒ«]        [è¿½åŠ ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ•ãƒ­ãƒ¼

1. **æ–½è¨­åã§æ¤œç´¢** â†’ æ¤œç´¢ãƒœã‚¿ãƒ³æŠ¼ä¸‹ã§Nominatim API
2. **å€™è£œã‹ã‚‰é¸æŠ** â†’ åœ°å›³ã«ãƒ”ãƒ³è¡¨ç¤º
3. **å¾®èª¿æ•´**ï¼ˆä»»æ„ï¼‰â†’ ãƒ”ãƒ³ã‚’ãƒ‰ãƒ©ãƒƒã‚°
4. **ç²¾åº¦é¸æŠ** â†’ geohashæ–‡å­—æ•°
5. **æŠ•ç¨¿** â†’ `["g", "xn76urx1"]` ã‚¿ã‚°è¿½åŠ 

â€» ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ˆå…¥åŠ›ä¸­ã«å€™è£œè¡¨ç¤ºï¼‰ã¯Nominatimåˆ©ç”¨è¦ç´„ã§ç¦æ­¢

## è¡¨ç¤º

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @username Â· 2æ™‚é–“å‰              â”‚
â”‚                                  â”‚
â”‚ é‡‘é–£å¯ºã«è¡Œã£ã¦ããŸï¼              â”‚
â”‚ [å†™çœŸ]                           â”‚
â”‚                                  â”‚
â”‚ ğŸ“ é‡‘é–£å¯º [åœ°å›³ã‚’è¦‹ã‚‹]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœ°å›³ãƒªãƒ³ã‚¯

```typescript
function getMapUrl(geohash: string): string {
  const { latitude, longitude } = geohash.decode(geohash)
  return `https://www.openstreetmap.org/?mlat=${latitude}&mlon=${longitude}&zoom=17`
}
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| æ©Ÿèƒ½ | ãƒ„ãƒ¼ãƒ« | æ–™é‡‘ | åˆ¶é™ |
|------|--------|------|------|
| åœ°åæ¤œç´¢ | Nominatim | ç„¡æ–™ | 1ç§’1ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆç¦æ­¢ |
| åœ°å›³è¡¨ç¤º | Leaflet | ç„¡æ–™ | ãªã— |
| åœ°å›³ã‚¿ã‚¤ãƒ« | OpenStreetMap | ç„¡æ–™ | ãªã— |
| èˆªç©ºå†™çœŸ | ESRI Satellite | ç„¡æ–™ | ãªã— |
| geohashå¤‰æ› | ngeohash | ç„¡æ–™ | ãªã— |

### ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
pnpm add leaflet ngeohash
pnpm add -D @types/leaflet
```

### Nominatim API

```typescript
async function searchPlace(query: string): Promise<Place[]> {
  const res = await fetch(
    `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=5`,
    {
      headers: {
        'User-Agent': 'mypace/1.0'  // å¿…é ˆ
      }
    }
  )
  return res.json()
}
```

### Geohashã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰

```typescript
import geohash from 'ngeohash'

// ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆç²¾åº¦8ï¼‰
const hash = geohash.encode(35.0116, 135.7681, 8) // "xn76urx1"

// ãƒ‡ã‚³ãƒ¼ãƒ‰
const { latitude, longitude } = geohash.decode("xn76urx1")
```

### Leafletåœ°å›³

```typescript
import L from 'leaflet'

// OSM
const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: 'Â© OpenStreetMap'
})

// ESRIèˆªç©ºå†™çœŸ
const satelliteLayer = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Â© Esri' }
)
```

## å®Ÿè£…å„ªå…ˆåº¦

1. geohashãƒ©ã‚¤ãƒ–ãƒ©ãƒªå°å…¥
2. å ´æ‰€è¿½åŠ ãƒœã‚¿ãƒ³ + ãƒ¢ãƒ¼ãƒ€ãƒ«UI
3. Nominatimæ¤œç´¢ï¼ˆãƒœã‚¿ãƒ³å¼ï¼‰
4. Leafletåœ°å›³è¡¨ç¤º
5. ãƒ”ãƒ³ãƒ‰ãƒ©ãƒƒã‚°å¾®èª¿æ•´
6. èˆªç©ºå†™çœŸåˆ‡ã‚Šæ›¿ãˆ
7. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºï¼ˆğŸ“ã‚¢ã‚¤ã‚³ãƒ³ + ãƒªãƒ³ã‚¯ï¼‰

## å‚è€ƒ

- [NIP-52 Calendar Events](https://github.com/nostr-protocol/nips/blob/master/52.md) - `g`ã‚¿ã‚°ä»•æ§˜
- [Nominatim Usage Policy](https://operations.osmfoundation.org/policies/nominatim/) - åˆ©ç”¨è¦ç´„
- [Leaflet](https://leafletjs.com/) - åœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- [ngeohash](https://github.com/sunng87/node-geohash) - geohashãƒ©ã‚¤ãƒ–ãƒ©ãƒª
