# シール機能計画

## 概要

投稿の上に自由配置できる画像「シール」機能。
LINEのスタンプ文化のように、mypace独自のシール文化を作る。

## コンセプト

- 投稿カードの上に**絶対配置**で画像を重ねる
- 左上からの相対位置（%）で指定
- 投稿の右側の空白活用、または文字に重ねる
- ヴィレバン的な安っぽいPOP感
- Zapでシールを売買できる経済圏

## 表示イメージ

### 空白活用パターン
```
┌──────────────────────────────────┐
│ こんにちは、今日は             ┌──────┐
│ いい天気ですね。               │100円 │
│                                │引き！│
│ 散歩に行ってきました。         └──────┘
│
│ [通常の画像]                   ┌────┐
│                                │注目│
│ また明日。                     └────┘
└──────────────────────────────────┘
```

### 文字に重ねるパターン
```
┌──────────────────────────────────┐
│ こんにちは、今日は                │
│ いい天気┌────┐ね。               │
│         │SALE│                   │
│ 散歩に行└────┘きました。         │
│                                   │
└──────────────────────────────────┘
```

### 複数シール
```
┌──────────────────────────────────┐
│ ┌───┐                            │
│ │NEW│ 新商品のお知らせ           │
│ └───┘                     ┌────┐ │
│ 詳しくはこちら...         │限定│ │
│                           └────┘ │
└──────────────────────────────────┘
```

## データ構造

### Nostrイベントタグ
```json
{
  "kind": 1,
  "content": "本文テキスト...",
  "tags": [
    ["t", "mypace"],
    ["mypace", "sticker", "<url>", "<x%>", "<y%>", "<size%>"],
    ["mypace", "sticker", "<url2>", "<x%>", "<y%>", "<size%>"]
  ]
}
```

例:
```json
["mypace", "sticker", "https://example.com/pop.png", "85", "10", "20"]
```
→ 左から85%、上から10%、幅20%

### 投稿時の構文案

```
本文テキスト...

[sticker:https://example.com/pop.png:85:10:20]
[sticker:https://example.com/new.png:5:5:15]
```

## 実装

### CSS
```css
.post-card {
  position: relative; /* シールの基準点 */
}

.sticker {
  position: absolute;
  pointer-events: none; /* 下の要素をクリック可能に */
  z-index: 10;
}

/* 例: x=85%, y=10%, size=20% */
.sticker[data-x="85"][data-y="10"] {
  left: 85%;
  top: 10%;
  width: 20%;
}
```

### JavaScript
```typescript
function parseStickers(tags: string[][]): Sticker[] {
  return tags
    .filter(t => t[0] === 'mypace' && t[1] === 'sticker')
    .map(t => ({
      url: t[2],
      x: parseInt(t[3], 10),
      y: parseInt(t[4], 10),
      size: parseInt(t[5], 10),
    }))
}
```

### React コンポーネント
```tsx
function PostStickers({ stickers }: { stickers: Sticker[] }) {
  return (
    <>
      {stickers.map((s, i) => (
        <img
          key={i}
          src={s.url}
          className="sticker"
          style={{
            left: `${s.x}%`,
            top: `${s.y}%`,
            width: `${s.size}%`,
          }}
        />
      ))}
    </>
  )
}
```

## シールエディタUI

### アイコンデザイン

ジョジョ6部「キッス」のシールをオマージュ:
- 四角いシール形状
- 唇マーク（リップ）
- ツールチップ: 「シールを貼る」

```
┌─────┐
│ 💋  │  ← キッス風シールアイコン
└─────┘
```

### 投稿フォームに追加
1. 「シールを貼る」ボタン（キッスアイコン）
2. シール選択モーダル（自分のシール一覧）
3. プレビュー上でドラッグして位置決め
4. サイズ調整スライダー

### シール配置フロー
```
1. シール画像を選択（アップロード or ライブラリ）
2. プレビュー上でドラッグ＆ドロップ
3. 位置・サイズを調整
4. 確定 → タグに変換
```

## シール経済（Zap連携）

### シールの売買
- シール作者がシール画像をNFT的に公開
- 欲しい人がZapで購入
- 購入したシールは自分の投稿で使用可能

### シールの定義イベント（案）
```json
{
  "kind": 30078,  // または新規kind
  "content": "シールの説明",
  "tags": [
    ["d", "sticker-id"],
    ["image", "https://example.com/sticker.png"],
    ["price", "100"],  // sats
    ["name", "100円引きPOP"]
  ]
}
```

### 使用権の記録
- 購入時にZapイベントで記録
- シール使用時にライセンスチェック（オプション）
- または信頼ベース（チェックなし）

## シールの種類案

### 汎用POP系
- 「NEW」「SALE」「限定」「注目」
- 「100円引き」「半額」「お得」
- 「おすすめ」「人気」「急上昇」

### リアクション系
- 「いいね」「最高」「草」
- 「泣ける」「感動」「神」
- 「ツッコミ」「なんでやねん」

### 装飾系
- キラキラエフェクト
- 矢印・吹き出し
- フレーム・枠

## 他クライアントでの表示

シールタグを理解しないクライアントでは:
- 本文のみ表示（シールは無視される）
- 構文 `[sticker:...]` を本文に残す場合はそのまま表示

## 実装優先度

1. 基本表示（タグからシール描画）
2. 投稿時の構文パース
3. シールエディタUI（ドラッグ配置）
4. シールライブラリ
5. Zap連携（売買機能）

## 注意点

- シール画像も nostr.build 経由（削除不可）
- 過度なシールはうざい → 枚数制限を検討
- モバイルでの配置操作UX
- パフォーマンス（多数のシール描画）
