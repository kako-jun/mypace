# テキストフィルタ（OK/NGワード・タグ）

タイムラインの投稿をキーワードやタグでフィルタリングする機能。

## 概要

フィルタパネルで設定できるテキストベースのフィルタ:

| フィルタ | 動作 | ロジック |
|----------|------|----------|
| OKワード | 指定ワードを含む投稿のみ表示 | OR（いずれかを含む） |
| OKタグ | 指定タグを含む投稿のみ表示 | OR または AND |
| NGワード | 指定ワードを含む投稿を非表示 | OR（いずれかを含めば除外） |
| NGタグ | 指定タグを含む投稿を非表示 | OR（いずれかを含めば除外） |

## 入力形式

すべてのフィルタで **スペース** または **カンマ** 区切りで複数指定可能。

```
猫 犬 鳥
猫, 犬, 鳥
猫,犬,鳥
```

上記はすべて同じ意味（3つのキーワード指定）。

## OKワード

投稿本文に指定ワードを含むものだけを表示。

### 検索ロジック

- **OR検索**: いずれかのワードを含めば表示
- **部分一致**: 単語の途中でもマッチ（「漫画」で「少年漫画」「漫画家」もヒット）
- **大文字小文字**: 区別しない（case-insensitive）

### 例

```
入力: 猫 犬
結果: 「猫が好き」「犬と散歩」どちらも表示、「鳥を飼う」は非表示
```

### URL形式

```
/?q=猫+犬
/?q=猫,犬
```

## OKタグ

投稿本文に指定タグ（`#tag` または `@@path`）を含むものだけを表示。

### 検索ロジック

- **区切り文字で動作が変わる**:
  - スペース/カンマ区切り → **OR検索**
  - `+` 区切り → **AND検索**
- ハッシュタグ `#tag` とスーパーメンション `@@path` の両方に対応
- スーパーメンション検索は `/path` 形式で指定

### 例

```
入力: mypace, nostr     → #mypace OR #nostr
入力: mypace+nostr      → #mypace AND #nostr
入力: /ハンチョウ       → @@ハンチョウ を含む投稿
```

### URL形式

```
/?tags=mypace,nostr      # OR検索
/?tags=mypace+nostr      # AND検索
```

## NGワード

投稿本文に指定ワードを含むものを非表示。

### 検索ロジック

- **OR除外**: いずれかのワードを含めば非表示
- **部分一致**: 単語の途中でもマッチ
- **大文字小文字**: 区別しない

### 例

```
入力: 広告 PR
結果: 「広告です」「PR案件」を含む投稿は非表示
```

### URL形式

```
/?ng=広告+PR
/?ng=広告,PR
```

## NGタグ

投稿本文に指定タグを含むものを非表示。

### 検索ロジック

- **OR除外**: いずれかのタグを含めば非表示
- ハッシュタグとスーパーメンション両対応

### 例

```
入力: nsfw, ad
結果: #nsfw または #ad を含む投稿は非表示
```

### URL形式

```
/?ngtags=nsfw,ad
```

## フィルタの優先順位

1. **サーバーサイドフィルタ**（mypace、SNS/Blog、Ads/NSFW、言語）
2. **OKタグ** → 指定タグを含むもののみ残す
3. **OKワード** → 指定ワードを含むもののみ残す
4. **NGワード** → 指定ワードを含むものを除外
5. **NGタグ** → 指定タグを含むものを除外
6. **ミュートリスト** → ミュートユーザーの投稿を除外

OKとNGに同じワードを指定した場合、NGが優先（除外される）。

## UI

FilterPanel内のOK/NGグループ:

```
┌─────────────────────────────────────┐
│ OK                                  │
│   🔍 [キーワード...]                │
│   #  [タグ...]                      │
├─────────────────────────────────────┤
│ NG                                  │
│   🚫 [キーワード...]                │
│   #  [タグ...]                      │
└─────────────────────────────────────┘
```

- 各入力欄の右に×ボタン（クリアボタン）
- Enterキーで即座にフィルタ適用
- Escキーでポップアップを閉じる

## 実装ファイル

| ファイル | 役割 |
|----------|------|
| `components/filter/FilterFields.tsx` | OK/NG入力欄UI |
| `components/filter/FilterPanel.tsx` | フィルタパネル全体 |
| `components/timeline/Timeline.tsx` | クライアントサイドフィルタ実行 |
| `lib/utils/navigation/navigation.ts` | URL解析・生成 |
| `lib/utils/content/content.ts` | `contentHasTag` タグマッチング |
| `types/index.ts` | `SearchFilters` 型定義 |

## 関連ドキュメント

- [kind-filter.md](./kind-filter.md) - SNS/Blogフィルタ
- [smart-filter.md](./smart-filter.md) - Ads/NSFWスマートフィルタ
- [filter-presets.md](./filter-presets.md) - プリセット保存
- [mute-list.md](./mute-list.md) - ミュートリスト
