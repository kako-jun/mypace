# Shared Article Quoteï¼ˆå…±æœ‰è¨˜äº‹å¼•ç”¨ï¼‰

å¤–éƒ¨è¨˜äº‹URLã‚’å…±é€šã®ã€Œè¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã§å¼•ç”¨æŠ•ç¨¿ã—ã€è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„Ÿæƒ³ã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã—ã¦é›†ç´„ã™ã‚‹æ©Ÿèƒ½ã€‚

## æ¦‚è¦

å¾“æ¥ã®Intent Shareï¼ˆ`/intent/post`ï¼‰ã§ã¯ã€å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå€‹åˆ¥ã«è¨˜äº‹URLã‚’è‡ªåˆ†ã®æŠ•ç¨¿ã«åŸ‹ã‚è¾¼ã‚“ã§ã„ãŸã€‚ã“ã‚Œã§ã¯åŒã˜è¨˜äº‹ã¸ã®æ„Ÿæƒ³ãŒæ•£åœ¨ã—ã€è­°è«–ãŒç”Ÿã¾ã‚Œã«ãã„ã€‚

Shared Article Quoteã§ã¯ï¼š
- **è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ãŒè¨˜äº‹ã‚’ä»£è¡¨ã—ã¦å¼•ç”¨æŠ•ç¨¿
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®å¼•ç”¨æŠ•ç¨¿ã¸ã®**ãƒªãƒ—ãƒ©ã‚¤**ã¨ã—ã¦æ„Ÿæƒ³ã‚’æŠ•ç¨¿
- åŒã˜è¨˜äº‹ã¸ã®æ„Ÿæƒ³ãŒ**1ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰**ã«é›†ç´„ã•ã‚Œã‚‹

ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ã€Œãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ–ã‚¯ãƒã€ã‚„ã€ã‚¹ãƒ¬ãƒƒãƒ‰æ²ç¤ºæ¿ã®ã‚ˆã†ã«ã€èª°ã§ã‚‚è¨˜äº‹ã‚’å¼•ç”¨ã•ã›ã€æ„Ÿæƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã®èµ·ç‚¹ã‚’ä½œã‚Œã‚‹ã€‚

## ã‚³ãƒ³ã‚»ãƒ—ãƒˆå›³

```
å¾“æ¥ï¼ˆIntent Shareï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼A     â”‚  â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼B     â”‚  â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼C     â”‚
â”‚ è¨˜äº‹URL      â”‚  â”‚ è¨˜äº‹URL      â”‚  â”‚ è¨˜äº‹URL      â”‚
â”‚ æ„Ÿæƒ³...      â”‚  â”‚ æ„Ÿæƒ³...      â”‚  â”‚ æ„Ÿæƒ³...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘ æ•£åœ¨ï¼ˆé–¢é€£æ€§ãªã—ï¼‰

æ–°æ©Ÿèƒ½ï¼ˆShared Article Quoteï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“° è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå…±é€šï¼‰                      â”‚
â”‚ ã€Œã‚¸ãƒ£ãƒ³ãƒ—ï¼‹ã®æ–°é€£è¼‰ãŒã‚¹ã‚¿ãƒ¼ãƒˆã€              â”‚
â”‚ https://shonenjumpplus.com/episode/xxx      â”‚
â”‚ [OGPç”»åƒãƒ»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»èª¬æ˜]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â†’ [ãƒªãƒ—ãƒ©ã‚¤] ãƒ¦ãƒ¼ã‚¶ãƒ¼A: é¢ç™½ã‹ã£ãŸï¼
      â”‚
      â”œâ”€â†’ [ãƒªãƒ—ãƒ©ã‚¤] ãƒ¦ãƒ¼ã‚¶ãƒ¼B: çµµãŒãã‚Œã„
      â”‚
      â””â”€â†’ [ãƒªãƒ—ãƒ©ã‚¤] ãƒ¦ãƒ¼ã‚¶ãƒ¼C: æ¥é€±ã‚‚æ¥½ã—ã¿
            â†‘ ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã—ã¦é›†ç´„
```

## ç”¨èªå®šç¾©

| ç”¨èª | èª¬æ˜ |
|------|------|
| è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ | MY PACEãŒç®¡ç†ã™ã‚‹å…±é€šã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€‚è¨˜äº‹å¼•ç”¨å°‚ç”¨ |
| å¼•ç”¨æŠ•ç¨¿ | è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã™ã‚‹ã€è¨˜äº‹URL+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€kind:1æŠ•ç¨¿ |
| æ„Ÿæƒ³ãƒªãƒ—ãƒ©ã‚¤ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¼•ç”¨æŠ•ç¨¿ã«å¯¾ã—ã¦æŠ•ç¨¿ã™ã‚‹ãƒªãƒ—ãƒ©ã‚¤ |
| URLãƒãƒƒã‚·ãƒ¥ | å¼•ç”¨æŠ•ç¨¿ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®URLæ­£è¦åŒ–ãƒãƒƒã‚·ãƒ¥ |

## Intent URL

### å¼•ç”¨Intent

```
https://mypace.llll-ll.com/intent/quote?url=è¨˜äº‹URL
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å¿…é ˆ | èª¬æ˜ |
|-----------|------|------|
| `url` | â—‹ | å¼•ç”¨ã™ã‚‹è¨˜äº‹ã®URLï¼ˆURLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¿…é ˆï¼‰ |
| `comment` | - | æ„Ÿæƒ³ã®åˆæœŸãƒ†ã‚­ã‚¹ãƒˆï¼ˆä»»æ„ï¼‰ |

### ä½¿ç”¨ä¾‹

```html
<!-- å¤–éƒ¨ã‚µã‚¤ãƒˆã®ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
<a href="https://mypace.llll-ll.com/intent/quote?url=https://shonenjumpplus.com/episode/xxx">
  MY PACEã§æ„Ÿæƒ³ã‚’æ›¸ã
</a>
```

```javascript
// JavaScriptï¼ˆå‹•çš„ï¼‰
function shareToMypaceQuote(comment = '') {
  const params = new URLSearchParams({
    url: location.href,
    ...(comment && { comment })
  })
  window.open(`https://mypace.llll-ll.com/intent/quote?${params}`, '_blank')
}
```

## å‹•ä½œãƒ•ãƒ­ãƒ¼

### 1. æ–°è¦å¼•ç”¨ï¼ˆè¨˜äº‹ãŒæœªç™»éŒ²ã®å ´åˆï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: /intent/quote?url=https://example.com/article ã«ã‚¢ã‚¯ã‚»ã‚¹
    â”‚
    â–¼
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: GET /api/quote?url=... ã§æ—¢å­˜ã®å¼•ç”¨æŠ•ç¨¿ã‚’æ¤œç´¢
    â”‚
    â–¼ è¦‹ã¤ã‹ã‚‰ãªã„
    â”‚
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: POST /api/quote { url } ã§å¼•ç”¨æŠ•ç¨¿ã®ä½œæˆã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    â”‚
    â–¼
API:
  1. URLã‹ã‚‰OGPæƒ…å ±ã‚’å–å¾—ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€ç”»åƒï¼‰
  2. è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å¼•ç”¨æŠ•ç¨¿ã‚’ä½œæˆãƒ»ç½²å
  3. Nostrãƒªãƒ¬ãƒ¼ã«å…¬é–‹
  4. å¼•ç”¨æŠ•ç¨¿ã®ã‚¤ãƒ™ãƒ³ãƒˆIDã‚’è¿”å´
    â”‚
    â–¼
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒªãƒ—ãƒ©ã‚¤ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºï¼ˆå¼•ç”¨æŠ•ç¨¿ã¸ã®è¿”ä¿¡ã¨ã—ã¦ï¼‰
    â”‚
    â–¼
ãƒ¦ãƒ¼ã‚¶ãƒ¼: æ„Ÿæƒ³ã‚’å…¥åŠ›ã—ã¦æŠ•ç¨¿
```

### 2. æ—¢å­˜å¼•ç”¨ã¸ã®è¿½åŠ ï¼ˆè¨˜äº‹ãŒç™»éŒ²æ¸ˆã¿ã®å ´åˆï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: /intent/quote?url=https://example.com/article ã«ã‚¢ã‚¯ã‚»ã‚¹
    â”‚
    â–¼
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: GET /api/quote?url=... ã§æ—¢å­˜ã®å¼•ç”¨æŠ•ç¨¿ã‚’æ¤œç´¢
    â”‚
    â–¼ è¦‹ã¤ã‹ã£ãŸ
    â”‚
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: æ—¢å­˜ã®å¼•ç”¨æŠ•ç¨¿ã‚’å–å¾—
    â”‚
    â–¼
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒªãƒ—ãƒ©ã‚¤ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºï¼ˆæ—¢å­˜ã®å¼•ç”¨æŠ•ç¨¿ã¸ã®è¿”ä¿¡ã¨ã—ã¦ï¼‰
```

## APIä»•æ§˜

### GET /api/quote

URLã«å¯¾å¿œã™ã‚‹å¼•ç”¨æŠ•ç¨¿ã‚’æ¤œç´¢ã€‚

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```
GET /api/quote?url=https://example.com/article
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```typescript
// è¦‹ã¤ã‹ã£ãŸå ´åˆ
{
  "found": true,
  "event": {
    "id": "abc123...",
    "pubkey": "è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®pubkey",
    "created_at": 1234567890,
    "kind": 1,
    "content": "...",
    "tags": [...]
  },
  "metadata": {
    "title": "è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«",
    "description": "è¨˜äº‹ã®èª¬æ˜",
    "image": "https://example.com/ogp.jpg",
    "replyCount": 15  // æ„Ÿæƒ³ãƒªãƒ—ãƒ©ã‚¤æ•°
  }
}

// è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
{
  "found": false
}
```

### POST /api/quote

æ–°ã—ã„å¼•ç”¨æŠ•ç¨¿ã‚’ä½œæˆã€‚

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```typescript
POST /api/quote
Content-Type: application/json

{
  "url": "https://example.com/article"
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```typescript
{
  "success": true,
  "event": {
    "id": "abc123...",
    // ... ä½œæˆã•ã‚ŒãŸå¼•ç”¨æŠ•ç¨¿ã®ã‚¤ãƒ™ãƒ³ãƒˆ
  },
  "metadata": {
    "title": "è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«",
    "description": "è¨˜äº‹ã®èª¬æ˜",
    "image": "https://example.com/ogp.jpg"
  }
}
```

#### ã‚¨ãƒ©ãƒ¼

```typescript
// OGPå–å¾—å¤±æ•—
{ "error": "ogp_fetch_failed", "message": "Failed to fetch OGP data" }

// ä¸æ­£ãªURL
{ "error": "invalid_url", "message": "URL is not valid" }

// æ—¢ã«å­˜åœ¨ï¼ˆç«¶åˆï¼‰
{ "error": "already_exists", "eventId": "abc123..." }
```

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### å¼•ç”¨æŠ•ç¨¿ï¼ˆkind:1ï¼‰

```typescript
{
  kind: 1,
  pubkey: "è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®pubkey",
  created_at: timestamp,
  tags: [
    ['t', 'mypace'],
    ['t', 'mypace-quote'],        // å¼•ç”¨æŠ•ç¨¿è­˜åˆ¥ã‚¿ã‚°
    ['client', 'mypace'],
    ['r', 'https://example.com/article'],  // è¨˜äº‹URLï¼ˆNIP-25æº–æ‹ ï¼‰
    ['url-hash', 'sha256-hash'],  // URLæ­£è¦åŒ–ãƒãƒƒã‚·ãƒ¥ï¼ˆæ¤œç´¢ç”¨ï¼‰
    // OGPãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
    ['ogp:title', 'è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«'],
    ['ogp:description', 'è¨˜äº‹ã®èª¬æ˜...'],
    ['ogp:image', 'https://example.com/ogp.jpg']
  ],
  content: "ğŸ“° è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«\n\nhttps://example.com/article",
  id: "...",
  sig: "..."
}
```

### ã‚¿ã‚°ã®å½¹å‰²

| ã‚¿ã‚° | å½¹å‰² |
|------|------|
| `t:mypace` | MY PACEãƒ•ã‚£ãƒ«ã‚¿ç”¨ |
| `t:mypace-quote` | å¼•ç”¨æŠ•ç¨¿ã®è­˜åˆ¥ |
| `r` | è¨˜äº‹URLï¼ˆNIP-25æº–æ‹ ã€ä»–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆäº’æ›ï¼‰ |
| `url-hash` | URLæ­£è¦åŒ–ãƒãƒƒã‚·ãƒ¥ï¼ˆé‡è¤‡é˜²æ­¢ãƒ»æ¤œç´¢ç”¨ï¼‰ |
| `ogp:*` | OGPãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤ºç”¨ï¼‰ |

### URLæ­£è¦åŒ–

åŒã˜è¨˜äº‹ã¸ã®é‡è¤‡å¼•ç”¨ã‚’é˜²ããŸã‚ã€URLã‚’æ­£è¦åŒ–ã—ã¦ãƒãƒƒã‚·ãƒ¥åŒ–ï¼š

```typescript
function normalizeUrl(url: string): string {
  const parsed = new URL(url)
  // 1. ãƒ—ãƒ­ãƒˆã‚³ãƒ«çµ±ä¸€ï¼ˆhttpsï¼‰
  parsed.protocol = 'https:'
  // 2. ãƒˆãƒ¬ã‚¤ãƒªãƒ³ã‚°ã‚¹ãƒ©ãƒƒã‚·ãƒ¥é™¤å»
  parsed.pathname = parsed.pathname.replace(/\/+$/, '')
  // 3. ä¸è¦ãªã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é™¤å»ï¼ˆutm_*, ref, etc.ï¼‰
  const keepParams = ['id', 'episode', 'chapter', 'p', 'page']
  for (const key of [...parsed.searchParams.keys()]) {
    if (!keepParams.includes(key) && !key.startsWith('v')) {
      parsed.searchParams.delete(key)
    }
  }
  // 4. ãƒãƒƒã‚·ãƒ¥é™¤å»
  parsed.hash = ''
  return parsed.toString()
}

function hashUrl(url: string): string {
  const normalized = normalizeUrl(url)
  return sha256(normalized)
}
```

## è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

### æ¦‚è¦

- å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å…±é€šã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- MY PACEé‹å–¶ãŒç®¡ç†
- è¨˜äº‹å¼•ç”¨æŠ•ç¨¿ã®ã¿ã‚’è¡Œã†ï¼ˆæ„Ÿæƒ³ã¯æ›¸ã‹ãªã„ï¼‰
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å: `ğŸ“° MY PACE Reporter` ãªã©

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     POST /api/quote      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ãƒ­ãƒ³ãƒˆ    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ Cloudflare Workers (API)         â”‚
â”‚ ã‚¨ãƒ³ãƒ‰      â”‚     { url: "..." }       â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ 1. OGPå–å¾—                       â”‚
                                         â”‚ 2. REPORTER_SECRET_KEY ã§ç½²å    â”‚
                                         â”‚ 3. Nostrãƒªãƒ¬ãƒ¼ã«å…¬é–‹             â”‚
                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯URLã‚’é€ã‚‹ã ã‘ã€‚ç½²åã¯ã™ã¹ã¦ã‚µãƒ¼ãƒãƒ¼å´ã§è¡Œã†ã€‚

### éµã®ç”Ÿæˆ

```bash
# 1. æ–°ã—ã„Nostréµãƒšã‚¢ã‚’ç”Ÿæˆï¼ˆnostr-toolsã‚’ä½¿ç”¨ï¼‰
npx tsx apps/api/scripts/generate-reporter-keys.ts

# å‡ºåŠ›ä¾‹:
# Secret Key (hex): 0123456789abcdef...
# Public Key (hex): fedcba9876543210...
# nsec: nsec1...
# npub: npub1...
```

ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹:

```typescript
// apps/api/scripts/generate-reporter-keys.ts
import { generateSecretKey, getPublicKey } from 'nostr-tools/pure'
import { nsecEncode, npubEncode } from 'nostr-tools/nip19'
import { bytesToHex } from '@noble/hashes/utils'

const sk = generateSecretKey()
const pk = getPublicKey(sk)

console.log('Secret Key (hex):', bytesToHex(sk))
console.log('Public Key (hex):', pk)
console.log('nsec:', nsecEncode(sk))
console.log('npub:', npubEncode(pk))
console.log('')
console.log('Set as Cloudflare Workers secrets:')
console.log('  wrangler secret put REPORTER_SECRET_KEY')
console.log('  (paste the hex secret key)')
```

### ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# Cloudflare Workers secrets ã¨ã—ã¦è¨­å®šï¼ˆwrangler.tomlã«ã¯æ›¸ã‹ãªã„ï¼‰
wrangler secret put REPORTER_SECRET_KEY
# â†’ hexå½¢å¼ã®ç§˜å¯†éµã‚’å…¥åŠ›ï¼ˆ64æ–‡å­—ï¼‰
```

å…¬é–‹éµã¯ç§˜å¯†éµã‹ã‚‰å°å‡ºã§ãã‚‹ãŸã‚ã€ç’°å¢ƒå¤‰æ•°ã¯ç§˜å¯†éµã®ã¿ã§ååˆ†ã€‚

### types.ts ã¸ã®è¿½åŠ 

```typescript
// apps/api/src/types.ts
export type Bindings = {
  DB: D1Database
  AI: Ai
  // ... æ—¢å­˜ã®ç’°å¢ƒå¤‰æ•° ...

  // Reporter account for Shared Article Quote
  REPORTER_SECRET_KEY?: string  // hexå½¢å¼ï¼ˆ64æ–‡å­—ï¼‰
}
```

### éµç®¡ç†ã®å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cloudflare Workers                      â”‚
â”‚                                         â”‚
â”‚ ç’°å¢ƒå¤‰æ•°ï¼ˆwrangler secretï¼‰:            â”‚
â”‚   REPORTER_SECRET_KEY = "0123..."      â”‚ â† hexå½¢å¼ï¼ˆ64æ–‡å­—ï¼‰
â”‚                                         â”‚
â”‚ å…¬é–‹éµã¯ getPublicKey(sk) ã§å°å‡º        â”‚
â”‚ â€» ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯Wrangler secretsã§ç®¡ç†  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç½²åãƒ•ãƒ­ãƒ¼

```typescript
// apps/api/src/routes/quote.ts
import { Hono } from 'hono'
import { finalizeEvent, getPublicKey } from 'nostr-tools/pure'
import { hexToBytes } from '@noble/hashes/utils'
import type { Bindings } from '../types'

const app = new Hono<{ Bindings: Bindings }>()

app.post('/quote', async (c) => {
  const { url } = await c.req.json<{ url: string }>()

  // 1. ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ç§˜å¯†éµã‚’å–å¾—ã—ã€å…¬é–‹éµã‚’å°å‡º
  const sk = c.env.REPORTER_SECRET_KEY
  if (!sk) {
    return c.json({ error: 'reporter_not_configured' }, 500)
  }
  const pk = getPublicKey(hexToBytes(sk))

  // 2. æ—¢å­˜ã®å¼•ç”¨æŠ•ç¨¿ã‚’ç¢ºèªï¼ˆD1ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
  const existing = await findExistingQuote(c.env.DB, url)
  if (existing) {
    return c.json({ found: true, event: existing })
  }

  // 3. OGPæƒ…å ±ã‚’å–å¾—
  const ogp = await fetchOGP(url)

  // 4. è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç½²å
  const event = {
    kind: 1,
    pubkey: pk,
    created_at: Math.floor(Date.now() / 1000),
    tags: [
      ['t', 'mypace'],
      ['t', 'mypace-quote'],
      ['client', 'mypace'],
      ['r', url],
      ['url-hash', hashUrl(url)],
      ['ogp:title', ogp.title],
      ['ogp:description', ogp.description || ''],
      ['ogp:image', ogp.image || '']
    ],
    content: `ğŸ“° ${ogp.title}\n\n${url}`
  }

  const signedEvent = finalizeEvent(event, hexToBytes(sk))

  // 5. Nostrãƒªãƒ¬ãƒ¼ã«å…¬é–‹
  await publishToRelays(signedEvent)

  // 6. D1ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
  await saveQuoteToCache(c.env.DB, url, signedEvent, ogp)

  return c.json({ success: true, event: signedEvent })
})
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- ç§˜å¯†éµã¯ã‚µãƒ¼ãƒãƒ¼å´ã®ç’°å¢ƒå¤‰æ•°ã«ã®ã¿å­˜åœ¨
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯URLã‚’é€ã‚‹ã ã‘ã§ã€ç½²åã«ã¯é–¢ä¸ã—ãªã„
- VAPIDéµã¨åŒæ§˜ã« `wrangler secret` ã§å®‰å…¨ã«ç®¡ç†

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```typescript
// App.tsx
<Route path="/intent/quote" element={<QuoteIntentPage />} />
```

### QuoteIntentPage

```typescript
// pages/QuoteIntentPage.tsx
export function QuoteIntentPage() {
  const [searchParams] = useSearchParams()
  const url = searchParams.get('url')
  const initialComment = searchParams.get('comment') || ''

  const [quoteEvent, setQuoteEvent] = useState<Event | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    if (!url) {
      setError('URLãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“')
      setLoading(false)
      return
    }

    fetchOrCreateQuote(url)
      .then(setQuoteEvent)
      .catch(e => setError(e.message))
      .finally(() => setLoading(false))
  }, [url])

  if (loading) return <LoadingSpinner />
  if (error) return <ErrorMessage message={error} />

  // å¼•ç”¨æŠ•ç¨¿ãŒå–å¾—ã§ããŸã‚‰ã€ãƒªãƒ—ãƒ©ã‚¤ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
  return (
    <QuoteReplyView
      quoteEvent={quoteEvent}
      initialContent={initialComment}
    />
  )
}
```

### QuoteReplyView

```typescript
// components/quote/QuoteReplyView.tsx
export function QuoteReplyView({ quoteEvent, initialContent }: Props) {
  return (
    <div className="quote-reply-view">
      {/* å¼•ç”¨æŠ•ç¨¿ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */}
      <QuotePreviewCard event={quoteEvent} />

      {/* æ—¢å­˜ã®æ„Ÿæƒ³ãƒªãƒ—ãƒ©ã‚¤ä¸€è¦§ */}
      <QuoteReplies quoteEventId={quoteEvent.id} />

      {/* ãƒªãƒ—ãƒ©ã‚¤ãƒ•ã‚©ãƒ¼ãƒ  */}
      <PostForm
        replyTo={quoteEvent}
        initialContent={initialContent}
        placeholder="ã“ã®è¨˜äº‹ã¸ã®æ„Ÿæƒ³ã‚’æ›¸ã..."
      />
    </div>
  )
}
```

### QuotePreviewCard

```typescript
// components/quote/QuotePreviewCard.tsx
export function QuotePreviewCard({ event }: { event: Event }) {
  const ogp = extractOGPFromTags(event.tags)
  const url = event.tags.find(t => t[0] === 'r')?.[1]

  return (
    <div className="quote-preview-card">
      <div className="quote-reporter">
        <ReporterAvatar />
        <span>ğŸ“° MY PACE Reporter</span>
      </div>

      <a href={url} target="_blank" rel="noopener noreferrer">
        {ogp.image && <img src={ogp.image} alt="" className="ogp-image" />}
        <div className="ogp-content">
          <h3>{ogp.title}</h3>
          {ogp.description && <p>{ogp.description}</p>}
          <span className="ogp-url">{new URL(url).hostname}</span>
        </div>
      </a>
    </div>
  )
}
```

## D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰

APIãƒ¬ã‚¹ãƒãƒ³ã‚¹é«˜é€ŸåŒ–ã®ãŸã‚ã€D1ã«å¼•ç”¨æŠ•ç¨¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€‚

### ã‚¹ã‚­ãƒ¼ãƒ

```sql
CREATE TABLE article_quotes (
  url_hash TEXT PRIMARY KEY,      -- URLæ­£è¦åŒ–ãƒãƒƒã‚·ãƒ¥
  url TEXT NOT NULL,              -- å…ƒURL
  event_id TEXT NOT NULL,         -- Nostrã‚¤ãƒ™ãƒ³ãƒˆID
  event_json TEXT NOT NULL,       -- ã‚¤ãƒ™ãƒ³ãƒˆJSONï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
  ogp_title TEXT,
  ogp_description TEXT,
  ogp_image TEXT,
  reply_count INTEGER DEFAULT 0,  -- æ„Ÿæƒ³ãƒªãƒ—ãƒ©ã‚¤æ•°ï¼ˆå®šæœŸæ›´æ–°ï¼‰
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL
);

CREATE INDEX idx_quotes_event_id ON article_quotes(event_id);
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

1. **GETæ™‚**: D1ã‚’å…ˆã«æ¤œç´¢ â†’ ãƒ’ãƒƒãƒˆã—ãŸã‚‰ãã®ã¾ã¾è¿”å´ â†’ ãƒŸã‚¹ãªã‚‰ãƒªãƒ¬ãƒ¼æ¤œç´¢
2. **POSTæ™‚**: ãƒªãƒ¬ãƒ¼ã«å…¬é–‹ â†’ D1ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
3. **ãƒªãƒ—ãƒ©ã‚¤æ•°**: Cronã‚¸ãƒ§ãƒ–ã§å®šæœŸæ›´æ–°ï¼ˆ1æ™‚é–“ã”ã¨ï¼‰

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹æ™‚ã®ãƒªãƒ¬ãƒ¼æ¤œç´¢

D1ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã„å ´åˆã€Nostrãƒªãƒ¬ãƒ¼ã‹ã‚‰å¼•ç”¨æŠ•ç¨¿ã‚’æ¤œç´¢ã™ã‚‹ï¼š

```typescript
async function findQuoteFromRelay(url: string, reporterPubkey: string): Promise<Event | null> {
  const urlHash = hashUrl(url)

  // æ–¹æ³•1: url-hashã‚¿ã‚°ã§æ¤œç´¢ï¼ˆæ¨å¥¨ï¼‰
  const filter = {
    kinds: [1],
    authors: [reporterPubkey],
    '#url-hash': [urlHash],
    limit: 1
  }

  // æ–¹æ³•2: authorsã®ã¿ã§æ¤œç´¢ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ•ã‚£ãƒ«ã‚¿
  // ï¼ˆãƒªãƒ¬ãƒ¼ãŒ#url-hashã‚’ã‚µãƒãƒ¼ãƒˆã—ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
  const fallbackFilter = {
    kinds: [1],
    authors: [reporterPubkey],
    '#t': ['mypace-quote'],
    limit: 100
  }

  const events = await fetchFromRelays(filter)
  return events[0] || null
}
```

**æ³¨æ„**: ãƒªãƒ¬ãƒ¼æ¤œç´¢ã§ãƒ’ãƒƒãƒˆã—ãŸå ´åˆã¯ã€D1ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›¸ãæˆ»ã™ã€‚

### ç«¶åˆåˆ¶å¾¡ï¼ˆRace Conditionï¼‰

åŒæ™‚ã«è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜URLã‚’å¼•ç”¨ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã®å¯¾ç­–ï¼š

```sql
-- INSERT OR IGNORE ã§é‡è¤‡ã‚’é˜²æ­¢
INSERT OR IGNORE INTO article_quotes (url_hash, url, event_id, ...)
VALUES (?, ?, ?, ...);
```

```typescript
app.post('/quote', async (c) => {
  const { url } = await c.req.json<{ url: string }>()
  const urlHash = hashUrl(url)

  // 1. ã¾ãšD1ã«å­˜åœ¨ç¢ºèª
  const existing = await findExistingQuote(c.env.DB, urlHash)
  if (existing) {
    return c.json({ found: true, event: existing })
  }

  // 2. ãƒªãƒ¬ãƒ¼ã«ã‚‚ç¢ºèªï¼ˆä»–ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆæ¸ˆã¿ã®å¯èƒ½æ€§ï¼‰
  const fromRelay = await findQuoteFromRelay(url, reporterPubkey)
  if (fromRelay) {
    // D1ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦è¿”å´
    await saveQuoteToCache(c.env.DB, url, fromRelay, extractOGP(fromRelay))
    return c.json({ found: true, event: fromRelay })
  }

  // 3. æ–°è¦ä½œæˆ
  const signedEvent = await createAndPublishQuote(url, c.env)

  // 4. D1ã«ä¿å­˜ï¼ˆINSERT OR IGNORE ã§ç«¶åˆã‚’ç„¡è¦–ï¼‰
  try {
    await saveQuoteToCache(c.env.DB, url, signedEvent, ogp)
  } catch (e) {
    // ç«¶åˆãŒç™ºç”Ÿã—ãŸå ´åˆã€æ—¢å­˜ã®ã‚‚ã®ã‚’è¿”ã™
    const raceWinner = await findExistingQuote(c.env.DB, urlHash)
    if (raceWinner) {
      return c.json({ found: true, event: raceWinner })
    }
  }

  return c.json({ success: true, event: signedEvent })
})
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- D1ã®`INSERT OR IGNORE`ã§é‡è¤‡æŒ¿å…¥ã‚’é˜²æ­¢
- ãƒªãƒ¬ãƒ¼ã¸ã®å…¬é–‹ã¯å†ªç­‰ã§ã¯ãªã„ãŒã€åŒã˜URLã«å¯¾ã—ã¦è¤‡æ•°ã®å¼•ç”¨æŠ•ç¨¿ãŒä½œã‚‰ã‚Œã¦ã‚‚ã€D1ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ­£ã¨ãªã‚‹
- æœ€æ‚ªã‚±ãƒ¼ã‚¹ã§ã‚‚ã€Œå°‘ã—ä½™åˆ†ãªå¼•ç”¨æŠ•ç¨¿ãŒãƒªãƒ¬ãƒ¼ã«æ®‹ã‚‹ã€ã ã‘ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã«ã¯å½±éŸ¿ã—ãªã„

## UI/UXè¨­è¨ˆ

### å¼•ç”¨Intentãƒšãƒ¼ã‚¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MY PACE                              [Ã—] é–‰ã˜ã‚‹ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“° MY PACE Reporter                         â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ [OGPç”»åƒ]                               â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«                            â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ è¨˜äº‹ã®èª¬æ˜æ–‡...                         â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ shonenjumpplus.com                      â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ’¬ ã¿ã‚“ãªã®æ„Ÿæƒ³ (15ä»¶)                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [ã‚¢ãƒã‚¿ãƒ¼] ãƒ¦ãƒ¼ã‚¶ãƒ¼A Â· 3æ™‚é–“å‰              â”‚ â”‚
â”‚ â”‚ é¢ç™½ã‹ã£ãŸï¼ä¸»äººå…¬ã®æˆé•·ãŒè‰¯ã„              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [ã‚¢ãƒã‚¿ãƒ¼] ãƒ¦ãƒ¼ã‚¶ãƒ¼B Â· 2æ™‚é–“å‰              â”‚ â”‚
â”‚ â”‚ çµµãŒãã‚Œã„ã§èª­ã¿ã‚„ã™ã„                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ã“ã®è¨˜äº‹ã¸ã®æ„Ÿæƒ³ã‚’æ›¸ã...                   â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚                                             â”‚ â”‚
â”‚ â”‚                              [æŠ•ç¨¿] ãƒœã‚¿ãƒ³  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§ã®è¡¨ç¤º

å¼•ç”¨æŠ•ç¨¿ã¸ã®æ„Ÿæƒ³ãƒªãƒ—ãƒ©ã‚¤ã¯ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã§ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒã‚¿ãƒ¼] ãƒ¦ãƒ¼ã‚¶ãƒ¼å Â· æ™‚åˆ»            â”‚
â”‚                                                 â”‚
â”‚ é¢ç™½ã‹ã£ãŸï¼ä¸»äººå…¬ã®æˆé•·ãŒè‰¯ã„                  â”‚
â”‚                                                 â”‚
â”‚ ğŸ“° è¿”ä¿¡å…ˆ: è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«                         â”‚ â† ã‚¯ãƒªãƒƒã‚¯ã§å¼•ç”¨æŠ•ç¨¿ã¸
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [OGPç”»åƒå°] è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«                    â”‚ â”‚
â”‚ â”‚ shonenjumpplus.com                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®

### URLæ¤œè¨¼

```typescript
const ALLOWED_URL_PATTERNS = [
  /^https:\/\/(www\.)?shonenjumpplus\.com\//,
  /^https:\/\/(www\.)?comic-zenon\.com\//,
  /^https:\/\/(www\.)?youtube\.com\//,
  /^https:\/\/youtu\.be\//,
  // ... è¨±å¯ãƒªã‚¹ãƒˆæ–¹å¼ or
  // å…¨URLè¨±å¯ï¼ˆã‚¹ãƒ‘ãƒ å¯¾ç­–ã¯åˆ¥é€”ï¼‰
]

function isAllowedUrl(url: string): boolean {
  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: è¨±å¯ãƒªã‚¹ãƒˆæ–¹å¼
  // return ALLOWED_URL_PATTERNS.some(p => p.test(url))

  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: å…¨URLè¨±å¯ï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ã§å¯¾ç­–ï¼‰
  return isValidHttpUrl(url)
}
```

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™

```typescript
// åŒä¸€IPã‹ã‚‰ã®å¼•ç”¨ä½œæˆã‚’åˆ¶é™
const RATE_LIMIT = {
  window: 60 * 60 * 1000,  // 1æ™‚é–“
  maxRequests: 10          // 10ä»¶ã¾ã§
}
```

### è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¿è­·

- ç§˜å¯†éµã¯Cloudflare Workersç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
- ã‚³ãƒ¼ãƒ‰ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ãªã„
- éµã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †ã‚’æ–‡æ›¸åŒ–

## å°†æ¥ã®æ‹¡å¼µ

### 1. ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°

```typescript
tags: [
  // ... æ—¢å­˜ã‚¿ã‚°
  ['t', 'manga'],      // ã‚«ãƒ†ã‚´ãƒªã‚¿ã‚°
  ['t', 'jumpplus'],   // ã‚µã‚¤ãƒˆã‚¿ã‚°
]
```

### 2. äººæ°—è¨˜äº‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°

```sql
-- ãƒªãƒ—ãƒ©ã‚¤æ•°ã§ã‚½ãƒ¼ãƒˆ
SELECT * FROM article_quotes
ORDER BY reply_count DESC
LIMIT 20
```

### 3. è¨˜äº‹ãƒ•ã‚£ãƒ¼ãƒ‰

`mypace-quote` ã‚¿ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ã—ã¦ã€å¼•ç”¨æŠ•ç¨¿ã ã‘ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’è¡¨ç¤ºã€‚

### 4. è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¤‡æ•°åŒ–

ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ã®è¨˜è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:
- `ğŸ“° MY PACE æ¼«ç”»`
- `ğŸ“° MY PACE å‹•ç”»`
- `ğŸ“° MY PACE ãƒ‹ãƒ¥ãƒ¼ã‚¹`

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² |
|---------|------|
| `apps/api/src/routes/quote.ts` | å¼•ç”¨APIå®Ÿè£… |
| `apps/web/src/pages/QuoteIntentPage.tsx` | Intentå‡¦ç†ãƒšãƒ¼ã‚¸ |
| `apps/web/src/components/quote/QuotePreviewCard.tsx` | å¼•ç”¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ |
| `apps/web/src/components/quote/QuoteReplies.tsx` | æ„Ÿæƒ³ãƒªãƒ—ãƒ©ã‚¤ä¸€è¦§ |
| `apps/web/src/lib/api/quote.ts` | APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |

## é–¢é€£

- [Intent Share](./intent-share.md) - å¾“æ¥ã®ãƒ†ã‚­ã‚¹ãƒˆå…±æœ‰æ©Ÿèƒ½
- [Repost](./repost.md) - ãƒªãƒã‚¹ãƒˆæ©Ÿèƒ½ï¼ˆNIP-18ï¼‰
- [Dynamic OGP](./dynamic-ogp.md) - OGPå–å¾—ã®å‚è€ƒå®Ÿè£…

---

[â† æ‹¡å¼µä¸€è¦§ã«æˆ»ã‚‹](./index.md)
